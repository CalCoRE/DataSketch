{"version":3,"file":"../../../../modules/datasketch/animation/animator.js","sources":["modules/datasketch/animation/animator.coffee"],"names":[],"mappings":"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","sourcesContent":["define (require) ->\r\n  EventDispatcher = require 'core/event/dispatcher'  \r\n  Globals = require 'core/model/globals'\r\n  class Animator extends EventDispatcher\r\n    @_isLoop = true\r\n\r\n    constructor: (@settings) ->\r\n      @_playhead = 0\r\n\r\n    play: () =>            \r\n      Globals.get('Canvas')._view._fabric.deactivateAll();\r\n      @_isPlaying = true\r\n      @_lastTime = (new Date).getTime()\r\n      window.opacityManager=1\r\n      @_animate()\r\n      window.arrayObject = []\r\n\r\n    pause: () =>\r\n      @_isPlaying = false\r\n      clearInterval(window.timer)\r\n      if window.arrayObject.length > 0\r\n         Globals.get('Canvas').removeObjects window.arrayObject\r\n      for obj in @settings.canvas.getObjects()\r\n        if obj != undefined\r\n          objId = obj.getId()          \r\n          if window[objId+\"arrayObject\"] != undefined  && window[objId+\"arrayObject\"].length > 0\r\n            Globals.get('Canvas').removeObjects window[objId+\"arrayObject\"]\r\n            window[objId+\"previousRow\"] = null\r\n      window.opacityManager=1\r\n\r\n    reset: () =>\r\n      @_playhead = 0\r\n\r\n    cache: () =>\r\n      for obj in @settings.canvas.getObjects()\r\n        obj.cacheState()\r\n\r\n    restore: () =>\r\n      for obj in @settings.canvas.getObjects()\r\n        obj.restoreState()\r\n      @settings.canvas.dryRender()\r\n\r\n    _animate: () =>\r\n      if @_isPlaying\r\n        currTime = (new Date).getTime()        \r\n        total = @settings.datastore.get('rows').length * window.DataSketchConfig.timePerRow * 1000        \r\n        delta = currTime - @_lastTime        \r\n        @_playhead = Math.min(total, @_playhead + delta)        \r\n        for obj in @settings.canvas.getObjects()\r\n          if obj != undefined\r\n            obj.animate @_playhead, delta, @settings.datastore\r\n          \r\n        @settings.canvas.dryRender()\r\n        @_lastTime = currTime        \r\n\r\n        @dispatchEvent 'Animator.Tick',\r\n          playhead: @_playhead\r\n          total: total\r\n        \r\n        if @_playhead >= total          \r\n          this.restore()  \r\n          @_isLoop= true\r\n          if @_isLoop\r\n            @_playhead = 0            \r\n          else\r\n            this.pause()\r\n            this.reset()            \r\n            ##Remove last animation from object  \r\n            mobject = this.settings.canvas.getSelectedObjects()            \r\n            objectProperty = mobject[0].getPropertyMappings()            \r\n            mobject[0].removePropertyMapping objectProperty[0]\r\n        \r\n        window.requestAnimationFrame @_animate       "]}