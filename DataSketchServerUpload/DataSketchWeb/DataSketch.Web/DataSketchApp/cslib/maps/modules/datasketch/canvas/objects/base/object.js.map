{"version":3,"file":"../../../../../../modules/datasketch/canvas/objects/base/object.js","sources":["modules/datasketch/canvas/objects/base/object.coffee"],"names":[],"mappings":"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","sourcesContent":["define (require) ->\r\n  Controller = require 'core/controller/controller'\r\n  Model = require './model'\r\n  View = require './view'\r\n  Matrix = require 'core/util/matrix'\r\n\r\n  class CanvasObject extends Controller\r\n    constructor: (settings = {}) ->\r\n      CanvasObject._count += 1\r\n      settings.modelData ?= {}\r\n      settings.modelData.id = CanvasObject._count\r\n\r\n      settings.modelClass ?= Model\r\n      settings.viewClass ?= View\r\n\r\n      super settings\r\n\r\n      @_view.addEventListener \"CanvasObject.Rotating\", @_onRotating\r\n      @_view.addEventListener \"CanvasObject.Scaling\", @_onScaling\r\n      @_view.addEventListener \"CanvasObject.Moving\", @_onMoving\r\n\r\n    root = exports ? this\r\n\r\n    getId: () =>\r\n      @_model.get('id')\r\n\r\n    getFabric: () =>\r\n      @view().getFabric()\r\n\r\n    enable: () =>\r\n      @_model.enable()\r\n\r\n    disable: () =>\r\n      @_model.disable()\r\n\r\n    enableControls: () =>\r\n      @_model.set 'controllable', true, true\r\n\r\n    disableControls: () =>\r\n      @_model.set 'controllable', false, true\r\n\r\n    getPosition: () =>\r\n      @_model.get 'position'\r\n\r\n    setPosition: (position) =>\r\n      @_model.set 'position',\r\n        x: position.x\r\n        y: position.y\r\n\r\n    setPositionofObject: (left,top) =>\r\n      @_model.set 'position',\r\n        x: left\r\n        y: top\r\n\r\n    enforceTransform: () =>\r\n      @_view.enforceTransform @_model\r\n\r\n    extractTransform: () =>\r\n      transform = @_view.extractTransform()\r\n      @_model.set \"position\", transform.position\r\n      @_model.set \"rotation\", transform.rotation\r\n      @_model.set \"scale\", transform.scale\r\n\r\n    getRotation: () =>\r\n      @_model.get 'rotation'\r\n\r\n    setRotation: (rotation) =>\r\n      @_model.set 'rotation', rotation\r\n\r\n    getScale: () =>\r\n      @_model.get 'scale'\r\n\r\n    setScale: (scale) =>\r\n      @_model.set 'scale',\r\n        x: scale.x\r\n        y: scale.y\r\n\r\n    getOpacity: () =>\r\n      @_model.get 'opacity'\r\n\r\n    setOpacity: (val) =>\r\n      @_model.set 'opacity', val\r\n\r\n    getTransform: () =>\r\n      transform =\r\n        position: @getPosition()\r\n        rotation: @getRotation() / 180 * Math.PI\r\n        scale: @getScale()\r\n      posMtx =\r\n        [\r\n          [1, 0, transform.position.x]\r\n          [0, 1, transform.position.y]\r\n          [0, 0, 1]\r\n        ]\r\n      rotMtx =\r\n        [\r\n          [Math.cos(transform.rotation), -Math.sin(transform.rotation), 0]\r\n          [Math.sin(transform.rotation), Math.cos(transform.rotation), 0]\r\n          [0, 0, 1]\r\n        ]\r\n      sclMtx =\r\n        [\r\n          [transform.scale.x, 0, 0]\r\n          [0, transform.scale.y, 0]\r\n          [0, 0, 1]\r\n        ]\r\n      Matrix.multiplyTransformMatrices posMtx, sclMtx, rotMtx\r\n\r\n    setTransform: (mtx) =>\r\n      radians = Math.atan2(-mtx[0][1], mtx[0][0])\r\n      transform =\r\n        position:\r\n          x: mtx[0][2]\r\n          y: mtx[1][2]\r\n        rotation: radians / Math.PI * 180\r\n        scale:\r\n          x: (mtx[0][0] / Math.abs(mtx[0][0])) * Math.sqrt(Math.pow(mtx[0][0], 2) + Math.pow(mtx[0][1], 2))\r\n          y: (mtx[1][1] / Math.abs(mtx[1][1])) * Math.sqrt(Math.pow(mtx[1][0], 2) + Math.pow(mtx[1][1], 2))\r\n      transform.scale.x *= Math.cos(radians) / Math.abs(Math.cos(radians))\r\n      transform.scale.y *= Math.cos(radians) / Math.abs(Math.cos(radians))\r\n\r\n      @setPosition transform.position\r\n      @setRotation transform.rotation\r\n      @setScale transform.scale\r\n\r\n    getBounds: () =>\r\n      rect = @getFabric().getBoundingRect()\r\n      bounds =\r\n        left: rect.left\r\n        right: rect.left + rect.width\r\n        top: rect.top\r\n        bottom: rect.top + rect.height\r\n\r\n    clone: () =>       \r\n\r\n    addPropertyMapping: (objectProperty, dataProperty, calibration) =>\r\n      @_model.addPropertyMapping objectProperty, dataProperty, calibration\r\n\r\n    removePropertyMapping: (objectProperty) =>\r\n      @_model.removePropertyMapping objectProperty\r\n\r\n    getPropertyMappings: () =>\r\n      @_model.get 'propertyMappings'\r\n    \r\n    #Set or Reset the counter for snap to grid\r\n    onclickofcanvas:(counter)=>       \r\n       if counter == 1\r\n          root.GridActive = 1\r\n       else if counter == 0\r\n          root.GridActive = 0\r\n\r\n    _onRotating: (evt) =>\r\n      @setRotation evt.data.rotation\r\n\r\n    _onScaling: (evt) =>\r\n      @setScale evt.data.scale\r\n      @setPosition evt.data.position\r\n\r\n    #check the snap to grid counter and stick object to grid if counter is set.\r\n    _onMoving: (evt) =>\r\n      if root.GridActive == 1\r\n         #window.GridSize = 30\r\n         evt.data.position.x = Math.round(evt.data.position.x /  window.GridSize) * window.GridSize\r\n         evt.data.position.y = Math.round(evt.data.position.y / window.GridSize) * window.GridSize\r\n         @setPosition evt.data.position\r\n      else  \r\n        @setPosition evt.data.position\r\n\r\n    animate: (playhead, timeDelta, datastore) =>\r\n      for map in @_model.get 'propertyMappings'  \r\n        map.applyMapping @, playhead, timeDelta, datastore\r\n\r\n\r\n    cacheState: () =>\r\n      @_model.cacheState()\r\n      this.enforceTransform()\r\n\r\n    restoreState: () =>\r\n      @_model.restoreState()\r\n      this.enforceTransform()\r\n\r\n  CanvasObject._count = 0\r\n  CanvasObject"]}