{"version":3,"sources":["modules/canvas/view.coffee"],"names":[],"mappings":"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","file":"modules/canvas/view.js","sourceRoot":"/source/","sourcesContent":["define (require) ->\n  DomView = require 'core/view/dom_view'\n  View = require 'core/view/view'\n  Utils = require 'core/util/utils'\n\n  class CanvasView extends DomView\n    constructor: (model) ->\n      super \"<canvas></canvas>\"\n      @context = @$el.get(0).getContext('2d')\n      @_lastTime = 0\n      @_actionCapture = false\n      @_update model\n      model.addEventListener 'Model.Change', @_onModelChange\n\n      @$el.on 'mousedown touchstart', @_onActionStart\n      @$el.on 'mouseup touchend', @_onActionEnd\n      @$el.on 'mousemove touchmove', @_onActionMove\n\n    ###\n    Public API\n    ----------\n\n    `addChild(child)`\n    ###\n    addChild: (child) ->\n      # Since the dom is no longer used inside the Canvas, we bypass DomView's\n      # default child handling, but retain the base View's handling.\n      View.prototype.addChild.call @, child\n\n    ###\n    `removeChild(child)`\n    ###\n    removeChild: (child) ->\n      # Since the dom is no longer used inside the Canvas, we bypass DomView's\n      # default child handling, but retain the base View's handling.\n      View.prototype.removeChild.call @, child\n\n    render: (currTime, model) =>\n      timeDelta = currTime - @_lastTime\n      @context.clearRect 0, 0, @$el.width(), @$el.height()\n      layers = model.get('layers')\n      for layer in [\"back\", \"focus\", \"meta\"]\n        @context.save()\n        if layer is \"back\" and layers.focus.length\n          @context.globalAlpha = model.get('isolationFade')\n        for obj in model.get(\"layers.#{layer}\")\n          obj.render @context, timeDelta\n        @context.restore()\n\n      @_lastTime = currTime\n\n    _onModelChange: (evt) =>\n      if evt.data.path in ['width', 'height']\n        @_update evt.currentTarget\n      if evt.data.path is \"mode\"\n        if evt.data.old?\n          @$el.removeClass \"mode-#{evt.data.old}\"\n        if evt.data.value?\n          @$el.addClass \"mode-#{evt.data.value}\"\n\n    _update: (model) =>\n      @$el.attr 'width', model.get('width')\n      @$el.attr 'height', model.get('height')\n\n    _onActionStart: (jqevt) =>\n      @_actionCapture = true\n      point = Utils.getPointFromEvent jqevt\n      @dispatchEvent 'Canvas.RequestActionStart',\n        point: point\n\n    _onActionMove: (jqevt) =>\n      if @_actionCapture\n        point = Utils.getPointFromEvent jqevt\n        @dispatchEvent 'Canvas.RequestActionMove',\n          point: point\n\n    _onActionEnd: (jqevt) =>\n      if @_actionCapture\n        @_actionCapture = false\n        @dispatchEvent 'Canvas.RequestActionEnd'"]}