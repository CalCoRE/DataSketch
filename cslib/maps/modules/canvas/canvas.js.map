{"version":3,"sources":["modules/canvas/canvas.coffee"],"names":[],"mappings":"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","file":"modules/canvas/canvas.js","sourceRoot":"/source/","sourcesContent":["define (require) ->\n  Controller = require 'core/controller/controller'\n  Model = require './model'\n  View = require './view'\n  Geom = require 'core/util/geom'\n  Utils = require 'core/util/utils'\n  Rectangle = require './objects/rectangle/object'\n  Group = require './objects/group/object'\n\n  class Canvas extends Controller\n    constructor: (settings = {}) ->\n      settings.modelClass ?= Model\n      settings.viewClass ?= View\n      super settings\n      window.requestAnimationFrame @render\n      @view().addEventListener \"Canvas.RequestActionStart\", @_onActionStartRequest\n      @view().addEventListener \"Canvas.RequestActionMove\", @_onActionMoveRequest\n      @view().addEventListener \"Canvas.RequestActionEnd\", @_onActionEndRequest\n      @_model.addEventListener \"Model.Change\", @_onModelChange\n\n    updateDimensions: (width, height) =>\n      @_model.set 'width', width\n      @_model.set 'height', height\n\n    setMode: (mode) =>\n      @_model.getCurrentMode()?.deactivate @\n      @_model.set 'mode', mode\n      @_model.getCurrentMode()?.activate @\n\n    addObject: (object, layer = \"focus\") =>\n      @_model.addObject object, layer\n\n    removeObject: (object, layer = \"focus\") =>\n      @_model.removeObject object, layer\n\n    selectObjects: (objects) =>\n      @_model.set 'selection', objects\n\n    deselect: () =>\n      @_model.set 'selection', []\n\n    getSelection: () =>\n      @_model.get 'selection'\n\n    getSelectionBounds: () =>\n      if @_model.get('selection')?.length\n        bounds =\n          left: null\n          right: null\n          top: null\n          bottom: null\n        for obj in @_model.get 'selection'\n          box = obj.boundingBox()\n          bounds.left ?= box.reference.x + box.offset.x\n          bounds.right ?= bounds.left + box.width\n          bounds.top ?= box.reference.y + box.offset.y\n          bounds.bottom ?= bounds.top + box.height\n\n          bounds.left = Math.min bounds.left, box.reference.x + box.offset.x\n          bounds.right = Math.max bounds.right, box.reference.x + box.offset.x + box.width\n          bounds.top = Math.min bounds.top, box.reference.y + box.offset.y\n          bounds.bottom = Math.max bounds.bottom, box.reference.y + box.offset.y + box.height\n        width = bounds.right - bounds.left\n        height = bounds.bottom - bounds.top\n        box =\n          reference:\n            x: bounds.left + width / 2\n            y: bounds.top + height / 2\n          offset:\n            x: -width / 2\n            y: -height / 2\n          width: width\n          height: height\n      else\n        null\n\n\n    getObjectsUnderRectangle: (rect) =>\n      objects = []\n      for object in @_model.get 'layers.focus'\n        box = object.boundingBox()\n        boxRect =\n          x: box.reference.x + box.offset.x\n          y: box.reference.y + box.offset.y\n          width: box.width\n          height: box.height\n        if Geom.getRectangleOverlap rect, boxRect\n          objects.push object\n      objects\n\n    getObjectsUnderPoint: (pt) =>\n      objects = []\n      for object in @_model.get 'layers.focus'\n        box = object.boundingBox()\n        boxRect =\n          x: box.reference.x + box.offset.x\n          y: box.reference.y + box.offset.y\n          width: box.width\n          height: box.height\n        if Geom.rectangleContainsPoint boxRect, pt\n          objects.push object\n      objects\n\n    render: (currTime) =>\n      window.requestAnimationFrame @render\n\n      @_view.render currTime, @_model\n\n    _onActionStartRequest: (evt) =>\n      @_model.getCurrentMode()?.actionStart evt.data.point\n\n    _onActionMoveRequest: (evt) =>\n      @_model.getCurrentMode()?.actionMove evt.data.point\n\n    _onActionEndRequest: (evt) =>\n      @_model.getCurrentMode()?.actionEnd()\n\n    _onModelChange: (evt) =>\n      switch evt.data.path\n        when \"selection\"\n          @_updateSelectionBox(evt.data)\n\n    _updateSelectionBox: (data) =>\n      for obj in data.old\n        obj.deselect()\n      for obj in data.value\n        obj.select()\n      if @_selectionBox?\n        @removeObject @_selectionBox, 'meta'\n      if @_model.get('selection')?.length\n        selBounds = @getSelectionBounds()\n        @_selectionBox = Rectangle.create\n          position: selBounds.reference\n          width: selBounds.width\n          height: selBounds.height\n          stroke:\n            width: 1\n            color: \"rgba(0,0,255,1)\"\n          fill: \"transparent\"\n        @addObject @_selectionBox, 'meta'\n      else\n        @_selectionBox = null"]}