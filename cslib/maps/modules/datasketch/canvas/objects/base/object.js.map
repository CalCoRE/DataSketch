{"version":3,"sources":["modules/datasketch/canvas/objects/base/object.coffee"],"names":[],"mappings":"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","file":"modules/datasketch/canvas/objects/base/object.js","sourceRoot":"/source/","sourcesContent":["define (require) ->\n  Controller = require 'core/controller/controller'\n  Model = require './model'\n  View = require './view'\n  Matrix = require 'core/util/matrix'\n\n  class CanvasObject extends Controller\n    constructor: (settings = {}) ->\n      CanvasObject._count += 1\n      settings.modelData ?= {}\n      settings.modelData.id = CanvasObject._count\n\n      settings.modelClass ?= Model\n      settings.viewClass ?= View\n\n      super settings\n\n      @_view.addEventListener \"CanvasObject.Rotating\", @_onRotating\n      @_view.addEventListener \"CanvasObject.Scaling\", @_onScaling\n      @_view.addEventListener \"CanvasObject.Moving\", @_onMoving\n\n    getId: () =>\n      @_model.get('id')\n\n    getFabric: () =>\n      @view().getFabric()\n\n    enable: () =>\n      @_model.enable()\n\n    disable: () =>\n      @_model.disable()\n\n    enableControls: () =>\n      @_model.set 'controllable', true, true\n\n    disableControls: () =>\n      @_model.set 'controllable', false, true\n\n    getPosition: () =>\n      @_model.get 'position'\n\n    setPosition: (position) =>\n      @_model.set 'position', position\n\n    enforceTransform: () =>\n      @_view.enforceTransform @_model\n\n    extractTransform: () =>\n      transform = @_view.extractTransform()\n      @_model.set \"position\", transform.position\n      @_model.set \"rotation\", transform.rotation\n      @_model.set \"scale\", transform.scale\n\n    getRotation: () =>\n      @_model.get 'rotation'\n\n    setRotation: (rotation) =>\n      @_model.set 'rotation', rotation\n\n    getScale: () =>\n      @_model.get 'scale'\n\n    setScale: (scale) =>\n      @_model.set 'scale', scale\n\n    getOpacity: () =>\n      @_model.get 'opacity'\n\n    setOpacity: (val) =>\n      @_model.set 'opacity', val\n\n    getTransform: () =>\n      transform =\n        position: @getPosition()\n        rotation: @getRotation() / 180 * Math.PI\n        scale: @getScale()\n      posMtx =\n        [\n          [1, 0, transform.position.x]\n          [0, 1, transform.position.y]\n          [0, 0, 1]\n        ]\n      rotMtx =\n        [\n          [Math.cos(transform.rotation), -Math.sin(transform.rotation), 0]\n          [Math.sin(transform.rotation), Math.cos(transform.rotation), 0]\n          [0, 0, 1]\n        ]\n      sclMtx =\n        [\n          [transform.scale.x, 0, 0]\n          [0, transform.scale.y, 0]\n          [0, 0, 1]\n        ]\n      Matrix.multiplyTransformMatrices posMtx, sclMtx, rotMtx\n\n    setTransform: (mtx) =>\n      radians = Math.atan2(-mtx[0][1], mtx[0][0])\n      transform =\n        position:\n          x: mtx[0][2]\n          y: mtx[1][2]\n        rotation: radians / Math.PI * 180\n        scale:\n          x: (mtx[0][0] / Math.abs(mtx[0][0])) * Math.sqrt(Math.pow(mtx[0][0], 2) + Math.pow(mtx[0][1], 2))\n          y: (mtx[1][1] / Math.abs(mtx[1][1])) * Math.sqrt(Math.pow(mtx[1][0], 2) + Math.pow(mtx[1][1], 2))\n      transform.scale.x *= Math.cos(radians) / Math.abs(Math.cos(radians))\n      transform.scale.y *= Math.cos(radians) / Math.abs(Math.cos(radians))\n\n      @setPosition transform.position\n      @setRotation transform.rotation\n      @setScale transform.scale\n\n    getBounds: () =>\n      rect = @getFabric().getBoundingRect()\n      bounds =\n        left: rect.left\n        right: rect.left + rect.width\n        top: rect.top\n        bottom: rect.top + rect.height\n\n    clone: () =>\n\n    addPropertyMapping: (objectProperty, dataProperty, calibration) =>\n      @_model.addPropertyMapping objectProperty, dataProperty, calibration\n\n    removePropertyMapping: (objectProperty) =>\n      @_model.removePropertyMapping objectProperty\n\n    getPropertyMappings: () =>\n      @_model.get 'propertyMappings'\n\n    _onRotating: (evt) =>\n      @setRotation evt.data.rotation\n\n    _onScaling: (evt) =>\n      @setScale evt.data.scale\n      @setPosition evt.data.position\n\n    _onMoving: (evt) =>\n      @setPosition evt.data.position\n\n    animate: (playhead, timeDelta, datastore) =>\n      for map in @_model.get 'propertyMappings'\n        map.applyMapping @, playhead, timeDelta, datastore\n\n    cacheState: () =>\n      @_model.cacheState()\n\n    restoreState: () =>\n      @_model.restoreState()\n\n  CanvasObject._count = 0\n  CanvasObject"]}