{"version":3,"sources":["modules/datasketch/canvas/canvas.coffee"],"names":[],"mappings":"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","file":"modules/datasketch/canvas/canvas.js","sourceRoot":"/source/","sourcesContent":["define (require) ->\n  Controller = require 'core/controller/controller'\n  View = require './view'\n  Model = require './model'\n  Globals = require 'core/model/globals'\n\n  Path = require './objects/path/object'\n  Group = require './objects/group/object'\n\n  class DSCanvas extends Controller\n    constructor: (config) ->\n      config ?= {}\n      config.modelClass ?= Model\n      config.viewClass ?= View\n\n      super config\n\n      @_model.addEventListener 'Model.Change', @_onModelChange\n      @view().addEventListener 'Selection.Created', @_onSelectionCreated\n      @view().addEventListener 'Selection.Modified', @_onSelectionModified\n      @view().addEventListener 'Selection.Cleared', @_onSelectionCleared\n      @view().addEventListener 'Path.Created', @_onPathCreated\n\n    render: () =>\n      @_view.render @_model\n\n    dryRender: () =>\n      @_view.dryRender()\n\n    getObjects: () =>\n      @_model.get 'objects'\n\n    getMode: () =>\n      @_model.get 'mode'\n\n    setMode: (mode) =>\n      @_model.set 'mode', mode\n\n    getStrokeWidth: () =>\n      @_model.get 'strokeWidth'\n\n    setStrokeWidth: (width) =>\n      if @_model.get 'selected'\n        for obj in @_model.get 'selected'\n          obj.setStrokeWidth width\n      @_model.set 'strokeWidth', width\n\n    getStrokeColor: () =>\n      @_model.get 'strokeColor'\n\n    setStrokeColor: (color) =>\n      if @_model.get 'selected'\n        for obj in @_model.get 'selected'\n          obj.setStrokeColor color\n      @_model.set 'strokeColor', color\n\n    getSelectedObjects: () =>\n      @_model.get 'selected'\n\n    selectObjects: (objects) =>\n      objectIds = (obj.getId() for obj in objects)\n      @_model.set 'selected', (obj for obj in @_model.getActiveObjects() when obj.getId() in objectIds)\n\n    addObject: (object, silent = false) =>\n      @_model.addObject object, silent\n\n    addObjects: (objects) =>\n      @_model.addObjects objects\n\n    removeObject: (object) =>\n      @_model.removeObject object\n\n    removeObjects: (objects) =>\n      @_model.removeObjects objects\n\n    removeSelected: () =>\n      @_model.removeSelected()\n\n    createGroup: (objects) =>\n      @_view.clearSelection()\n      if !objects?\n        objects = @_model.get 'selected'\n      if !objects?\n        return null\n\n      for obj in objects\n        obj.extractTransform()\n\n      group = Group.createFromObjects objects\n      @addObject group\n      @removeObjects objects\n      # @selectObjects [group]\n      group\n\n    breakGroup: (group) =>\n      objects = group.break()\n      @removeObject group\n      for obj in objects\n        @addObject obj\n        obj.enforceTransform()\n        obj.enableControls()\n      @render()\n      group.getObjects()\n\n    isolate: (group) =>\n      @_model.isolate group\n      @render()\n\n    getIsolation: () =>\n      @_model.get 'isolated'\n\n    setIsolation: (isolation) =>\n      @_model.set 'isolated', isolation\n\n    _onModelChange: (evt) =>\n      switch evt.data.path\n        when \"strokeWidth\"\n          @dispatchEvent \"Canvas.StrokeWidthChange\",\n            width: evt.data.value\n        when \"mode\"\n          @dispatchEvent \"Canvas.ModeChange\",\n            mode: evt.data.value\n            last: evt.data.old\n        when \"strokeColor\"\n          @dispatchEvent \"Canvas.StrokeColorChange\",\n            color: evt.data.value\n        when \"isolated\"\n          @_manageContextMenu()\n        when \"selected\"\n          @_manageContextMenu()\n        when \"objects\"\n          @render()\n\n    _manageContextMenu: () =>\n      Globals.get('Relay').dispatchEvent 'ContextMenu.ContextChange',\n        context:\n          selection: @_model.get('selected')\n          isolation: @_model.get('isolated')\n\n    _onPathCreated: (evt) =>\n      path = Path.createFromFabric evt.data.path\n      @_model.addObject path, true\n\n    _onSelectionCreated: (evt) =>\n      @selectObjects (obj for obj in @_model.getActiveObjects() when obj.getId() in evt.data.objectIds)\n\n    _onSelectionModified: (evt) =>\n\n    _onSelectionCleared: (evt) =>\n      @selectObjects []\n\n    initCanvas: () =>\n      @_view.initCanvas @_model\n\n    disable: () =>\n      @_model.disable()\n\n    enable: () =>\n      @_model.enable()\n\n    disableControls: () =>\n      @_model.disableControls()\n\n    enableControls: () =>\n      @_model.enableControls()\n"]}